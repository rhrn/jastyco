#!/usr/bin/env node

var program = require('commander');
var jastyco = require('../src/jastyco.js');
var utils = require('../src/utils.js');
var cwd = process.cwd();

var defaultPatterns = '**/*.jade **/*.coffee **/*.styl';
var configPath = utils.configPath(cwd, 'jastyco.json');

program
  .option('-b, --build', 'compile sources')
  .option('-s, --src <src>', 'source directory. current default')
  .option('-d, --dest <dest>', 'destination directory. current default')
  .option('-p, --patterns <patterns>', 'files patterns. "' + defaultPatterns + '" default')
  .option('-cp, --copy <patterns>', 'files to copy patterns')
  .option('-c, --config <config>', 'config file. "jastyco.json" default')
  .usage('[options] patterns');

program.parse(process.argv);

var options = utils.defaultOptions(program, defaultPatterns);

if (program.config) {
  configPath = utils.configPath(cwd, program.config);
}

config = utils.readConfig(configPath);

options = utils.extend(options, config);

options.cwd = cwd;

jastyco.jastyco(options);
