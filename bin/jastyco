#!/usr/bin/env node

var program = require('commander');
var jastyco = require('../src/jastyco.js');
var utils = require('../src/utils.js');
var cwd = process.cwd();

var defaultPatterns = '**/*.jade **/*.coffee **/*.styl';
var configPath = utils.configPath(cwd, 'jastyco.json');

program
  .version('0.0.4')
  .option('-b, --build', 'compile sources in batch mode. "false" default')
  .option('-s, --src <src>', 'source directory. current default')
  .option('-d, --dest <dest>', 'destination directory. current default')
  .option('-p, --patterns <patterns>', 'files compile by patterns. "' + defaultPatterns + '" default')
  .option('-C, --copy <patterns>', 'copy files on change by patterns')
  .option('-c, --config <config>', 'config file. "jastyco.json" default')
  .option('-X, --delete', 'delete dest file on delete source. "false" default')
  .usage('[options] patterns');

program.parse(process.argv);

var options = utils.defaultOptions(program, defaultPatterns);

if (program.config) {
  configPath = utils.configPath(cwd, program.config);
}

config = utils.readConfig(configPath);

options = utils.extend(options, config);

options.cwd = cwd;

jastyco.jastyco(options);
